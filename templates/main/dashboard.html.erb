<div class="container-fluid mt-2 mt-md-4">
    <div class="row">
        <div class="<%= current_user.mentor? ? 'col-lg-9' : 'col-lg-7' %>">
            <% if view.sessions.empty? %>
                <style>
                 #dashboard-no-sessions {
                     background: url(/img/laptop-house.svg) no-repeat center;
                     margin: 0 auto;
                     min-width: 70%;
                     max-width: 500px;
                     height: 300px;
                     text-align: center;
                 }
                </style>
                <div class="no-sessions pt-5 mt-md-4 text-muted" id="dashboard-no-sessions">
                    No sessions found.
                    <% unless current_user.mentor? %>
                        If your mentor is available you can start one by selecting an
                        <em>Instant Help</em> or <em>Instant Conversation</em>.
                    <% end %>
                </div>
            <% else %>
                <div id="sessions">
                    <% view.sessions.each do |session| %>
                            <div class="card mx-auto ml-md-0 mr-md-3 mb-3 d-inline-block" style="width:320px">
                                <div class="card-body">
                                    <h5 class="card-title mb-0">
                                        <%= session.product %> Session
                                    </h5>
                                    <p class="card-text text-muted">
                                        <small>
                                            <% if session.ended? %>
                                                Ended with <%= view.session_card.displayed_user(session) %>
                                                <%= time_ago_in_words session.ended_at %>
                                            <% else %>
                                                Started with <%= view.session_card.displayed_user(session) %>
                                                <%= time_ago_in_words session.started_at %>
                                            <% end %>
                                        </small>
                                        <% unless session.ended? %>
                                            <br>
                                            <%= fmt_time session.started_at %> &mdash; <%= fmt_time session.ended_at, '' %>
                                        <% end %>
                                        <% if session.ended? %>
                                            <br>
                                            <%= session.duration %>
                                            <% if session.billed? %>&mdash; Billed <%= session.cost %><% end %>
                                        <% end %>
                                    </p>
                                    <div class="d-flex justify-content-end">
                                        <a class="card-link" href="/session/<%= session.id %>">View</a>
                                    </div>
                                </div>
                            </div>
                    <% end %>
                </div>
            <% end %>
        </div>

        <div class="mt-4 mt-md-0 <%= current_user.mentor? ? 'col-lg-3' : 'col-lg-5' %>">
            <% if !current_user.mentor? %>
                <h5 class="text-muted border-bottom text-uppercase">Your Mentor</h5>
                <ul class="list-group list-group-flush">
                    <% view.mentors.each do |mentor| %>
                        <li class="list-group-item media">
                            <div class="d-flex">
                                <img src="<%= mentor.meta['profile.image_path'] %>"
                                     style="width:80px"
                                     class="mr-3 align-self-start rounded-circle">
                                <div>
                                    <h5 class="mb-2"><%= mentor %></h5>
                                    <dl>
                                        <dt class="text-muted"><i class="fas fa-clock"></i> Current Time</dt>
                                        <dd id="mentor-current-time">
                                            <span class="offset" style="visibility:hidden">
                                                <%= mentor.meta['profile.timezoneOffset'] %>
                                            </span>
                                            -
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                            <div class="media-body">
                                <dl class="mt-3">
                                    <dt class="text-muted mb-2 mt-3"><i class="fas fa-calendar-week"></i> Availability</dt>
                                    <dd>
                                        <%= mentor_availability_schedule mentor %>
                                    </dd>
                                </dl>
                            </div>
                        </li>
                    <% end %>
                </ul>

                <ul class="list-group list-group-flush mb-5 border-bottom">
                    <% view.products.each do |(product, purchased)| %>
                        <li class="list-group-item media d-flex justify-content-between align-items-center">
                            <img src="<%= product.image_path %>"
                                 alt="<%= product.name %> Image"
                                 style="height:50px" class="mr-3 align-self-start rounded">
                            <div class="media-body">
                                <h5 class="mb-0"><%= product %></h5>
                                <p style="font-size:0.8em"><%= product.description %></p>
                                <% if purchased %>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge badge-primary">purchased</span>
                                        <button class="btn btn-danger btn-sm">Cancel</button>
                                    </div>
                                <% else %>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <%= product_price product, size: 'sm', subscriber: subscriber?(view.products) %>
                                        <%= product_button product, size: 'sm' %>
                                    </div>
                                <% end %>
                            </div>
                        </li>
                    <% end %>
                </ul>
            <% else %>
                <% unless view.subscribers.empty? %>
                    <h5>Subscribers</h5>
                    <% view.subscribers.each do |subscriber| %>
                        <div class="card" style="width:250px">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <%= subscriber %>
                                </h6>
                                <div class="d-flex justify-content-end">
                                    <form action="/session" method="post">
                                        <input type="hidden" name="customer_id" value="<%= subscriber.id %>">
                                        <input type="hidden" name="product_id" value="<%= subscriber[:product_id] %>">
                                        <button class="btn btn-secondary btn-sm mr-2">
                                            New Session
                                        </button>
                                    </form>
                                    <a class="btn btn-secondary btn-sm" title="Email <%= subscriber %>"
                                       href="mailto:<%= subscriber.email %>">
                                        <i class="fas fa-paper-plane"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    <% end %>
                <% end %>
            <% end %>
        </div>
    </div>
</div>
